{% extends "base.html" %}
{% load static %}

{% block title %}Notifications | Style Bazaar{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 dark:bg-gray-900 py-12 px-4 transition-colors duration-500">
    <div class="max-w-5xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 dark:text-white mb-4">
                Notifications
            </h1>
            <p class="text-lg md:text-xl text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
                Stay updated with order status, messages from sellers, and exclusive promotions
            </p>
        </header>

        <!-- Tab Navigation -->
        <nav class="flex justify-center mb-10" aria-label="Notification tabs">
            <div class="inline-flex bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-1.5 border border-gray-200 dark:border-gray-700">
                <button
                    type="button"
                    data-tab="all"
                    class="tab-btn active px-6 py-3 rounded-xl font-semibold text-base transition-all duration-300"
                    aria-selected="true"
                >
                    All
                    {% if total_notifications > 0 %}
                        <span class="ml-2 text-sm font-normal opacity-80">({{ total_notifications }})</span>
                    {% endif %}
                </button>
                <button
                    type="button"
                    data-tab="order"
                    class="tab-btn px-6 py-3 rounded-xl font-semibold text-base transition-all duration-300"
                    aria-selected="false"
                >
                    Orders
                </button>
                <button
                    type="button"
                    data-tab="message"
                    class="tab-btn px-6 py-3 rounded-xl font-semibold text-base transition-all duration-300"
                    aria-selected="false"
                >
                    Messages
                </button>
                <button
                    type="button"
                    data-tab="promotion"
                    class="tab-btn px-6 py-3 rounded-xl font-semibold text-base transition-all duration-300"
                    aria-selected="false"
                >
                    Promotions
                </button>
            </div>
        </nav>

        <!-- Notifications List -->
        <section id="notifications-container" class="space-y-5" aria-live="polite">
            {% for notif in notifications %}
                <article
                    class="notification group bg-white dark:bg-gray-800 rounded-2xl shadow-md hover:shadow-xl border border-transparent
                           transition-all duration-400 ease-out hover:-translate-y-1
                           {% if not notif.is_read %}border-l-4 border-primary bg-primary/5 dark:bg-primary/10{% endif %}"
                    data-type="{{ notif.type }}"
                >
                    <div class="p-6 flex items-start gap-5">
                        <!-- Icon -->
                        <div class="flex-shrink-0">
                            <div class="w-14 h-14 rounded-full flex items-center justify-center text-2xl font-bold shadow-lg
                                        bg-gradient-to-br text-white
                                        {% if notif.type == 'order' %}from-emerald-500 to-teal-600
                                        {% elif notif.type == 'message' %}from-indigo-500 to-purple-600
                                        {% elif notif.type == 'promotion' %}from-orange-500 to-pink-600
                                        {% else %}from-gray-500 to-gray-700 dark:from-gray-600 dark:to-gray-800{% endif %}">
                                {{ notif.icon }}
                            </div>
                        </div>

                        <!-- Content -->
                        <div class="flex-1 min-w-0">
                            <div class="flex items-start justify-between gap-4">
                                <div class="flex-1">
                                    <h3 class="text-lg font-bold text-gray-900 dark:text-white flex items-center gap-3">
                                        {{ notif.title }}
                                        {% if not notif.is_read %}
                                            <span class="w-2.5 h-2.5 bg-primary rounded-full animate-pulse" aria-label="Unread"></span>
                                        {% endif %}
                                    </h3>

                                    {% if notif.sender_username %}
                                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                                            From: <span class="font-medium">{{ notif.sender_username }}</span>
                                        </p>
                                    {% endif %}

                                    <p class="text-gray-700 dark:text-gray-300 mt-3 leading-relaxed">
                                        {{ notif.message|linebreaksbr }}
                                    </p>

                                    <!-- Action Links -->
                                    {% if notif.link %}
                                        <a href="{{ notif.link }}"
                                           class="inline-flex items-center gap-2 mt-4 text-primary font-medium hover:text-primary-dark transition-colors"
                                           aria-label="View details">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                            </svg>
                                            View Details
                                        </a>
                                    {% elif notif.order_id %}
                                        <a href="{% url 'orders:buyer_order_tracking' notif.order_id %}"
                                           class="inline-flex items-center gap-2 mt-4 text-primary font-medium hover:text-primary-dark transition-colors"
                                           aria-label="Track order">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                            </svg>
                                            Track Order #SB-{{ notif.order_id }}
                                        </a>
                                    {% endif %}
                                </div>

                                <!-- Timestamp -->
                                <time class="text-sm text-gray-500 dark:text-gray-400 whitespace-nowrap mt-1" datetime="{{ notif.created_at|date:'c' }}">
                                    {{ notif.time }}
                                </time>
                            </div>
                        </div>

                        <!-- Right Arrow (visible on hover) -->
                        <div class="text-gray-400 dark:text-gray-500 group-hover:text-primary transition-colors self-center opacity-0 group-hover:opacity-100">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </div>
                    </div>
                </article>
            {% empty %}
                <!-- Empty State -->
                <div class="text-center py-20 bg-white dark:bg-gray-800 rounded-3xl shadow-xl border border-gray-200 dark:border-gray-700">
                    <div class="text-8xl mb-8 opacity-70">ðŸ””</div>
                    <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-100 mb-4">
                        You're all caught up!
                    </h2>
                    <p class="text-lg text-gray-600 dark:text-gray-300 max-w-md mx-auto leading-relaxed px-4">
                        No new notifications at the moment. Check back later for order updates, messages, and special offers.
                    </p>
                    <div class="mt-8">
                        <a href="{% url 'home' %}"
                           class="inline-block px-8 py-4 bg-primary text-white font-semibold rounded-xl hover:bg-primary-dark transition-all shadow-md hover:shadow-lg">
                            Continue Shopping
                        </a>
                    </div>
                </div>
            {% endfor %}
        </section>
    </div>
</div>

<!-- Tab Filtering Script -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    const tabs = document.querySelectorAll('.tab-btn');
    const container = document.getElementById('notifications-container');
    const notifications = container.querySelectorAll('.notification');

    tabs.forEach(tab => {
        tab.addEventListener('click', function () {
            const target = this.getAttribute('data-tab');
            const isAll = target === 'all';

            // Update active tab
            tabs.forEach(t => {
                t.classList.remove('bg-primary', 'text-white', 'shadow-md');
                t.classList.add('hover:bg-gray-100', 'dark:hover:bg-gray-700');
                t.setAttribute('aria-selected', 'false');
            });
            this.classList.add('bg-primary', 'text-white', 'shadow-md');
            this.classList.remove('hover:bg-gray-100', 'dark:hover:bg-gray-700');
            this.setAttribute('aria-selected', 'true');

            // Filter with smooth animation
            notifications.forEach(notif => {
                const type = notif.getAttribute('data-type');
                const shouldShow = isAll || type === target;

                notif.style.transition = 'opacity 0.4s ease, transform 0.4s ease';
                if (shouldShow) {
                    notif.style.display = 'block';
                    notif.style.opacity = '0';
                    notif.style.transform = 'translateY(20px)';
                    setTimeout(() => {
                        notif.style.opacity = '1';
                        notif.style.transform = 'translateY(0)';
                    }, 10);
                } else {
                    notif.style.opacity = '0';
                    notif.style.transform = 'translateY(-20px)';
                    setTimeout(() => {
                        notif.style.display = 'none';
                    }, 400);
                }
            });
        });
    });

    // Activate "All" tab on load
    document.querySelector('[data-tab="all"]').click();
});
</script>
{% endblock %}